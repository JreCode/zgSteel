<style type="text/css">
	.nav{
		height: 60px;
		width: 100%;
		border-bottom: 1px solid #f0f0f0;
	}
	.release_tit{
		height: 40px;
		width: 100%;
		margin-top: 20px;
		border: 1px solid #e6e6e6;
		border-radius: 2px;
		margin-bottom: 20px;
		position: relative;
	}
	.title_name{
		display: inline-block;
		line-height: 40px;
		font-size: 16px;
		color:#535353;
		font-weight: bold;
		width: 80px;
		text-align: center;
		border-right: 1px solid #f0f0f0;
	}
	.release_tit input{
		display: inline-block;
		top: 0;
		bottom: 0;
		right: 0;
		position: absolute;
		width: calc(100% - 90px);
		border:0;
	}
</style>
<div style="margin: 0;padding: 0;position: relative;">
	<div class="nav">
		<ul class="layui-nav" style="background: #fff;text-align: center;cursor: pointer;">
  			<li class="layui-nav-item layui-this" id="release"><a style="color:#5FB878">发布公告</a></li>
  			<li class="layui-nav-item"><a style="color:#5FB878">历史公告</a></li>
		</ul>
	</div>
</div>
<div class="release" style="margin-top: 40px;width: 90%;margin-left: 5%;">
	<div class="release_tit">
		<div class="title_name">标题</div>
		<input id="title_input" />
	</div>
	<textarea id="rule_text" style="display: none;"></textarea>
	<button class="layui-btn" style="margin-top: 20px;float: right;" id='fabu'>发布</button>
</div>
<div class="release_his"></div>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
layui.use('element', function(){
  var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
  
  //监听导航点击
  element.on('nav(demo)', function(elem){
    //console.log(elem)
    layer.msg(elem.text());
  });
});
$('.layui-nav-item').on('click',function(){
	$('.layui-nav-item').removeClass('layui-this');
	$(this).addClass('layui-this');
});
$('#release').on('click',function(){
	$('.release_his').css('display','none');
	$('.release').css('display','block');
	layui.use('layedit', function(){
  		var layedit = layui.layedit;
  		layedit.set({
  			uploadImage: {
    			url: 'http://47.104.218.70:16543/upload' //接口url
    			,type: 'post' //默认post
  			}
		});
  		var index = layedit.build('rule_text',{
  			tool: [
			  'strong' //加粗
			  ,'italic' //斜体
			  ,'underline' //下划线
			  ,'del' //删除线
			  
			  ,'|' //分割线
			  
			  ,'left' //左对齐
			  ,'center' //居中对齐
			  ,'right' //右对齐
                          
			  ,'|'
			  ,'link' //超链接
			  ,'unlink' //清除链接
			  ,'image' //插入图片
			],
			uploadImage: {
    			url: 'http://47.104.218.70:16543/upload' //接口url
    			,type: 'post' //默认post
  			}
  		}); //建立编辑器
  		$('#fabu').on('click',function(){
	 		let cont = layedit.getContent(index);
	 		let title = $('#title_input').val();
	 		let log = '公告「' + title + '」发布成功';
	 		if((title != '') & (cont != '')){
		 		let token = share.token;
	            let url = 'announcement';
		 		let datas = {
	                log: log,
	                title: title,
	                content: cont
	            };
	            let data = JSON.stringify(datas);
	            function success(e){
	            	console.log(e);
	                if(e == 'fail'){
	                    layui.use('layer',function(){
	                    	layer.msg('发布失败');
	                    });
	                }else if (e =='success'){
	                    layui.use('layer',function(){
	                        layer.msg('发布成功');
	                    });
	                }
	            }
	            util.POSTS(url,data,success,token);
	 		}else if(title == ''){
	 			layui.use('layer', function(){
                    layer.msg('标题不可为空');
                }); 
	 		}else if(cont == ''){
	 			layui.use('layer', function(){
                    layer.msg('内容不可为空');
                }); 
	 		}
		});
	});
});

</script>